# üî¥ –†–ï–®–ï–ù–ò–ï: Google Sheets API - 403 PERMISSION_DENIED

## –û—à–∏–±–∫–∞: "The caller does not have permission"

**–î–∞–∂–µ –µ—Å–ª–∏ APIs –≤–∫–ª—é—á–µ–Ω—ã**, –æ—à–∏–±–∫–∞ 403 –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞:

1. ‚ùå **Billing –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
2. ‚ùå **Service Account –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤**
3. ‚ùå **APIs –≤–∫–ª—é—á–µ–Ω—ã –≤ –î–†–£–ì–û–ú –ø—Ä–æ–µ–∫—Ç–µ**

---

## üéØ –ë–´–°–¢–†–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

–ó–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ (—Å —Ç–µ–º–∏ –∂–µ credentials —á—Ç–æ –Ω–∞ Railway):

```bash
cd projects/cp_parser

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
export GOOGLE_CREDENTIALS_JSON='{"type":"service_account","project_id":"...",...}'

# –ó–∞–ø—É—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
py diagnose_google_api.py
```

**–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:**
- ‚úÖ –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON
- ‚úÖ –§–æ—Ä–º–∞—Ç private_key
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ Sheets API
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ Drive API
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 1: –ù–ê–°–¢–†–û–ô BILLING (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### Google —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –∫–∞—Ä—Ç—ã –¥–∞–∂–µ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!

**–®–∞–≥ 1: –û—Ç–∫—Ä–æ–π Billing**

–ó–∞–º–µ–Ω–∏ `YOUR-PROJECT-ID` –Ω–∞ —Å–≤–æ–π project_id:

```
https://console.cloud.google.com/billing/linkedaccount?project=YOUR-PROJECT-ID
```

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å**

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ Billing account linked: My Billing Account
```

–ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ "No billing account":
```
‚ùå No billing account linked
```

**–≠–¢–û –ü–†–ò–ß–ò–ù–ê 403!**

**–®–∞–≥ 3: –ü—Ä–∏–≤—è–∂–∏ Billing Account**

1. –ö–ª–∏–∫–Ω–∏ **"Link a billing account"**
2. –í—ã–±–µ—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Billing Account –ò–õ–ò —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π:
   - Name: My Billing Account
   - Country: –í—ã–±–µ—Ä–∏ —Å—Ç—Ä–∞–Ω—É
   - Add payment method: –î–æ–±–∞–≤—å –∫–∞—Ä—Ç—É

**‚ö†Ô∏è –í–ê–ñ–ù–û:** Google –Ω–µ —Å–ø–∏—à–µ—Ç –¥–µ–Ω—å–≥–∏ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Sheets API (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –æ–≥—Ä–æ–º–Ω—ã–π), –Ω–æ –∫–∞—Ä—Ç–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!

**–®–∞–≥ 4: –ü–æ–¥–æ–∂–¥–∏ 2-3 –º–∏–Ω—É—Ç—ã**

–ü–æ—Å–ª–µ –ø—Ä–∏–≤—è–∑–∫–∏ Billing Account –ø–æ–¥–æ–∂–¥–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.

**–®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Railway**

Railway ‚Üí Your App ‚Üí **Restart**

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 2: –ù–ê–°–¢–†–û–ô IAM –†–û–õ–ò

### Service Account –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã!

**–®–∞–≥ 1: –û—Ç–∫—Ä–æ–π IAM**

–ó–∞–º–µ–Ω–∏ `YOUR-PROJECT-ID`:

```
https://console.cloud.google.com/iam-admin/iam?project=YOUR-PROJECT-ID
```

**–®–∞–≥ 2: –ù–∞–π–¥–∏ —Å–≤–æ–π Service Account**

–ò—â–∏ —Å—Ç—Ä–æ–∫—É —Å email:
```
your-service-account@your-project.iam.gserviceaccount.com
```

**–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å —Ä–æ–ª–∏**

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞** –∏–∑ —Ä–æ–ª–µ–π:

**–í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞):**
```
‚úÖ Editor
```

**–í–∞—Ä–∏–∞–Ω—Ç B (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞):**
```
‚úÖ Owner
```

**–í–∞—Ä–∏–∞–Ω—Ç C (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞):**
```
‚úÖ Service Usage Consumer
‚úÖ Storage Admin (–¥–ª—è Drive)
```

**–ï—Å–ª–∏ —Ä–æ–ª–µ–π –ù–ï–¢ –∏–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ "Service Account User":**

**–≠–¢–û –ü–†–ò–ß–ò–ù–ê 403!**

**–®–∞–≥ 4: –î–æ–±–∞–≤—å —Ä–æ–ª–∏**

1. –ö–ª–∏–∫–Ω–∏ –Ω–∞ –∫–∞—Ä–∞–Ω–¥–∞—à (Edit) –≤–æ–∑–ª–µ Service Account
2. –ö–ª–∏–∫–Ω–∏ **"+ ADD ANOTHER ROLE"**
3. –í—ã–±–µ—Ä–∏: **"Editor"**
4. –ö–ª–∏–∫–Ω–∏ **"Save"**

**–®–∞–≥ 5: –ü–æ–¥–æ–∂–¥–∏ 1-2 –º–∏–Ω—É—Ç—ã**

–ü—Ä–∞–≤–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

**–®–∞–≥ 6: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Railway**

Railway ‚Üí Your App ‚Üí **Restart**

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 3: –ü–†–û–í–ï–†–¨ –ß–¢–û APIs –í –ü–†–ê–í–ò–õ–¨–ù–û–ú –ü–†–û–ï–ö–¢–ï

### APIs –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã –í –¢–û–ú –ñ–ï –ø—Ä–æ–µ–∫—Ç–µ –≥–¥–µ Service Account!

**–®–∞–≥ 1: –£–∑–Ω–∞–π Project ID –∏–∑ credentials**

```json
{
  "type": "service_account",
  "project_id": "quickstart-1591698112539",  <-- –≠–¢–û –¢–í–û–ô PROJECT ID
  ...
}
```

**–®–∞–≥ 2: –û—Ç–∫—Ä–æ–π Google Cloud Console**

```
https://console.cloud.google.com
```

**–®–∞–≥ 3: –í–´–ë–ï–†–ò –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–†–û–ï–ö–¢**

**–í–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞** –≤ dropdown –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω:
```
‚úÖ quickstart-1591698112539
```

**–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –¥—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç** ‚Üí APIs –≤–∫–ª—é—á–µ–Ω—ã –Ω–µ —Ç–∞–º!

**–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å APIs –≤ –≠–¢–û–ú –ø—Ä–æ–µ–∫—Ç–µ**

```
https://console.cloud.google.com/apis/dashboard?project=quickstart-1591698112539
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
```
‚úÖ Google Sheets API - Enabled
‚úÖ Google Drive API - Enabled
```

---

## üîç –ü–û–†–Ø–î–û–ö –î–ï–ô–°–¢–í–ò–ô (–ß–ï–ö–õ–ò–°–¢)

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Billing (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!)

- [ ] –û—Ç–∫—Ä—ã–ª: https://console.cloud.google.com/billing/linkedaccount?project=YOUR-PROJECT-ID
- [ ] –í–∏–∂—É: "Billing account linked" ‚úÖ
- [ ] –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø—Ä–∏–≤—è–∑–∞–ª Billing Account —Å –∫–∞—Ä—Ç–æ–π
- [ ] –ü–æ–¥–æ–∂–¥–∞–ª 2-3 –º–∏–Ω—É—Ç—ã

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ IAM —Ä–æ–ª–µ–π

- [ ] –û—Ç–∫—Ä—ã–ª: https://console.cloud.google.com/iam-admin/iam?project=YOUR-PROJECT-ID
- [ ] –ù–∞—à–µ–ª –º–æ–π Service Account email
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —á—Ç–æ –µ—Å—Ç—å —Ä–æ–ª—å "Editor" –∏–ª–∏ "Owner"
- [ ] –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –¥–æ–±–∞–≤–∏–ª —Ä–æ–ª—å "Editor"
- [ ] –ü–æ–¥–æ–∂–¥–∞–ª 1-2 –º–∏–Ω—É—Ç—ã

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

- [ ] –í Google Cloud Console –≤—ã–±—Ä–∞–Ω –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø—Ä–æ–µ–∫—Ç (–≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞)
- [ ] Project ID = —Ç–æ—Ç –∂–µ —á—Ç–æ –≤ JSON credentials
- [ ] APIs –≤–∫–ª—é—á–µ–Ω—ã –≤ –≠–¢–û–ú –ø—Ä–æ–µ–∫—Ç–µ

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Railway

- [ ] Railway ‚Üí Your App ‚Üí Restart
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ API
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª —Å–æ–∑–¥–∞—Ç—å Google Sheets —Å–Ω–æ–≤–∞

---

## üß™ –¢–ï–°–¢ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
export GOOGLE_CREDENTIALS_JSON='...'
py diagnose_google_api.py
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´!
üéâ Google Sheets API –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

**–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—à–∏–±–∫–∞** ‚Üí —Å–∫–∏–Ω—å –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞, —Ä–∞–∑–±–µ—Ä–µ–º—Å—è!

---

## üìû –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–û–ú–û–©–¨

**–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤—Å—ë —Ä–∞–≤–Ω–æ 403:**

1. –°–∫–∏–Ω—å –≤—ã–≤–æ–¥ `diagnose_google_api.py`
2. –°–∫–∏–Ω—å —Å–∫—Ä–∏–Ω—à–æ—Ç:
   - Billing page
   - IAM page (Service Account —Å—Ç—Ä–æ–∫–∞)
   - APIs Dashboard

**99% —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ Billing –∏–ª–∏ IAM!**

