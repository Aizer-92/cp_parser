# Исправление отображения главных изображений

## Проблема

В веб-интерфейсе отображались неправильные главные изображения товаров, хотя в базе данных они были назначены корректно.

## Причина

Колонка `is_main_image` в таблице `product_images` имеет тип **TEXT**, а не BOOLEAN.
При сортировке `ORDER BY is_main_image DESC` PostgreSQL сортирует по алфавиту:
- **"None"** (строка) > **"true"** (строка) в обратном порядке
- В результате изображения с `is_main_image = NULL` показывались первыми
- А правильное главное изображение (`is_main_image = 'true'`) - последним

## Решение

Исправлена сортировка во всех запросах веб-интерфейса:

**Было:**
```sql
ORDER BY is_main_image DESC, display_order
```

**Стало:**
```sql
ORDER BY 
    CASE WHEN is_main_image::text = 'true' THEN 0 ELSE 1 END,
    cell_position,
    display_order
```

## Затронутые файлы

- `web_interface/app.py`:
  - `products_list()` - список товаров (строка 612)
  - `project_detail()` - детали проекта (строка 871)
  - `product_detail()` - детали товара (строка 1023)

## Результат

- ✅ Главные изображения теперь показываются первыми
- ✅ Изображения из столбца A (главные) имеют приоритет
- ✅ Работает корректно в списке товаров, детальной карточке и странице проекта

## Дополнительно выполнено

- Массово назначены главные изображения для 7,945 товаров
- Исправлены проекты #1307 и #372 (перепривязка изображений по диапазонам)
- Все товары с изображениями в столбце A теперь имеют корректное главное изображение

## Дата

14 октября 2025

