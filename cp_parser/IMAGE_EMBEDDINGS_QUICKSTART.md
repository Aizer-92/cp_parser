# üé® Image Embeddings - Quick Start

–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤.

---

## üìã –ß–¢–û –≠–¢–û –î–ê–ï–¢?

- üîç **–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤** –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- üéØ **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** - –ø–æ–Ω–∏–º–∞–µ—Ç –°–û–î–ï–†–ñ–ê–ù–ò–ï –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** –±–ª–∞–≥–æ–¥–∞—Ä—è pgvector –∏–Ω–¥–µ–∫—Å—É
- üåê **–ù–µ —Ç—Ä–µ–±—É–µ—Ç OpenAI** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–π CLIP –º–æ–¥–µ–ª–∏

---

## üöÄ –£–°–¢–ê–ù–û–í–ö–ê

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: sentence-transformers (–†–ï–ö–û–ú–ï–ù–î–£–Æ - –ø—Ä–æ—â–µ)
pip install sentence-transformers pillow requests

# –í–∞—Ä–∏–∞–Ω—Ç 2: transformers (–µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–≤—ã–π)
pip install transformers pillow torch requests
```

### 2. –ù–∞—Å—Ç—Ä–æ–π .env —Ñ–∞–π–ª

```bash
# .env (—É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)
DATABASE_URL=postgresql://...            # –û—Å–Ω–æ–≤–Ω–∞—è –ë–î
DATABASE_URL_PRIVATE=postgresql://...    # –û—Å–Ω–æ–≤–Ω–∞—è –ë–î (private)
VECTOR_DATABASE_URL=postgresql://...     # pgvector –ë–î –¥–ª—è embeddings
```

---

## üìä –ó–ê–ü–£–°–ö

### –®–ê–ì 1: –°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É image_embeddings

```bash
cd projects/cp_parser
py setup_image_embeddings.py
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- –¢–∞–±–ª–∏—Ü–∞ `image_embeddings` —Å –ø–æ–ª—è–º–∏:
  - `image_id` - ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ product_images
  - `product_id` - ID —Ç–æ–≤–∞—Ä–∞
  - `image_embedding` - –≤–µ–∫—Ç–æ—Ä —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ 512 (CLIP)
  - `image_url` - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  - `model_version` - –≤–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏

- –ò–Ω–¥–µ–∫—Å `ivfflat` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (cosine similarity)

---

### –®–ê–ì 2: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π embeddings –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```bash
py generate_image_embeddings.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç CLIP –º–æ–¥–µ–ª—å (~500MB, –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ)
2. –ß–∏—Ç–∞–µ—Ç –≥–ª–∞–≤–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ URL
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç embedding (–≤–µ–∫—Ç–æ—Ä 512 —á–∏—Å–µ–ª)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ pgvector –ë–î

**‚è±Ô∏è –í–†–ï–ú–Ø:**
- ~2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –î–ª—è 1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ~40-50 –º–∏–Ω—É—Ç
- –ú–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å Ctrl+C –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ

**üîÑ –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –ü–û–°–õ–ï –û–°–¢–ê–ù–û–í–ö–ò:**
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞: `py generate_image_embeddings.py`

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings –º–æ–∂–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫:

```bash
py test_image_search.py
```

(—Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ)

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

- **–û–¥–∏–Ω embedding:** 512 float32 = 2KB
- **1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** ~2MB
- **10,000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** ~20MB

### –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

- **–ü–æ–∏—Å–∫ –≤ 10K –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** ~10-50ms
- **–ü–æ–∏—Å–∫ –≤ 100K –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** ~50-200ms

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï?

1. ‚úÖ –°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É: `py setup_image_embeddings.py`
2. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π embeddings: `py generate_image_embeddings.py`
3. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
4. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –∏ –ø–æ–∏—Å–∫

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò

### –ú–æ–¥–µ–ª—å CLIP

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `clip-ViT-B-32`
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 512
- –ö–∞—á–µ—Å—Ç–≤–æ: —Ö–æ—Ä–æ—à–µ–µ
- –°–∫–æ—Ä–æ—Å—Ç—å: –±—ã—Å—Ç—Ä–∞—è

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- `clip-ViT-B-16` - –≤—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- `clip-ViT-L-14` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Å–∞–º–∞—è –º–µ–¥–ª–µ–Ω–Ω–∞—è

### Batch Size

–í —Å–∫—Ä–∏–ø—Ç–µ: `batch_size = 100`
- –£–≤–µ–ª–∏—á—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–Ω–æ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏)
- –£–º–µ–Ω—å—à–∏ –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç RAM

---

## ‚ùì TROUBLESHOOTING

### –û—à–∏–±–∫–∞: "No module named 'sentence_transformers'"

```bash
pip install sentence-transformers
```

### –û—à–∏–±–∫–∞: "No module named 'PIL'"

```bash
pip install pillow
```

### –û—à–∏–±–∫–∞: "Connection timeout"

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∏—Ö –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç.

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–π GPU –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –£–º–µ–Ω—å—à–∏ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- –ò—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å

---

## üìù NOTES

- Embeddings –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –≥–ª–∞–≤–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (`is_main_image = TRUE`)
- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ú–æ–¥–µ–ª—å CLIP —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –í—Å–µ embeddings —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π pgvector –ë–î (–Ω–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π)

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å? –ó–∞–ø—É—Å–∫–∞–π —à–∞–≥ 1!** üöÄ



