# –ú–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ (FTS)

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å –≤–µ—Å–æ–≤—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä—É—Å—Å–∫–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–µ–π.

## üö® –í–ê–ñ–ù–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è!

**–ü—Ä–æ–±–ª–µ–º–∞**: "–¢–∞–±–ª–µ—Ç–Ω–∏—Ü–∞" –∏ "–¢–∞–±–ª–µ—Ç–Ω–∏—Ü—ã" –Ω–∞—Ö–æ–¥–∏–ª–∏ —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è 'russian' –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
fts_module/
‚îú‚îÄ‚îÄ README.md                           # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ fts_search.py                       # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å FTS
‚îú‚îÄ‚îÄ export_fts_fixed.py                 # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞–∫–µ—Ç–æ–≤ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ test_final_morphology.py            # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏
‚îú‚îÄ‚îÄ FTS_DEPLOYMENT_GUIDE.md             # –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é
‚îî‚îÄ‚îÄ fts_deployment_latest/              # –ì–æ—Ç–æ–≤—ã–π –ø–∞–∫–µ—Ç –¥–µ–ø–ª–æ—è
    ‚îú‚îÄ‚îÄ fts_export_latest.sql           # SQL —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    ‚îî‚îÄ‚îÄ README.md                       # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from fts_module.fts_search import FullTextSearch

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
pg_config = {
    'host': 'localhost',
    'port': '5432', 
    'database': 'promo_calculator',
    'user': 'postgres',
    'password': 'postgres'
}

fts = FullTextSearch(pg_config)

# –ü–æ–∏—Å–∫ —Å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º
products, total_count = fts.search_products("—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞", limit=25)
```

### 2. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

```bash
# –°–æ–∑–¥–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –¥–µ–ø–ª–æ—è
py export_fts_fixed.py

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
psql -h <host> -U <user> -d <database> -f fts_deployment_latest/fts_export_latest.sql
```

## ‚öñÔ∏è –í–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã

| –í–µ—Å | –ü–æ–ª—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|------|----------|
| **A** | `title`, `original_title` | –í—ã—Å–æ–∫–∏–π –≤–µ—Å - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ |
| **B** | `brand`, `vendor` | –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å - –±—Ä–µ–Ω–¥—ã –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ |
| **C** | `description` | –ù–∏–∑–∫–∏–π –≤–µ—Å - –æ–ø–∏—Å–∞–Ω–∏—è |

## üîç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞
```sql
-- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (simple –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
SELECT COUNT(*) FROM products 
WHERE search_vector @@ plainto_tsquery('simple', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞');  -- 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

SELECT COUNT(*) FROM products 
WHERE search_vector @@ plainto_tsquery('simple', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü—ã');  -- 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

### –†–µ—à–µ–Ω–∏–µ
```sql
-- –ü–†–ê–í–ò–õ–¨–ù–û (russian –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
SELECT COUNT(*) FROM products 
WHERE search_vector @@ plainto_tsquery('russian', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞');  -- 121 —Ä–µ–∑—É–ª—å—Ç–∞—Ç

SELECT COUNT(*) FROM products 
WHERE search_vector @@ plainto_tsquery('russian', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü—ã');  -- 121 —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏

```bash
py test_morphology.py
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º —Å–ª–æ–≤–∞.

### –¢–µ—Å—Ç –≤ –∫–æ–¥–µ

```python
from fts_module.fts_search import FullTextSearch

fts = FullTextSearch(pg_config)

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
results = fts.test_search(["—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞", "—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü—ã", "—Ç–µ–ª–µ—Ñ–æ–Ω"])
print(results)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- "—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞": 0 —Ç–æ–≤–∞—Ä–æ–≤ (simple FTS)
- "—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü—ã": 0 —Ç–æ–≤–∞—Ä–æ–≤ (simple FTS)
- "—Ç–µ–ª–µ—Ñ–æ–Ω": 825 —Ç–æ–≤–∞—Ä–æ–≤ (simple FTS)
- "—Ç–µ–ª–µ—Ñ–æ–Ω–∞": 0 —Ç–æ–≤–∞—Ä–æ–≤ (simple FTS) ‚ùå

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- "—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞": 121 —Ç–æ–≤–∞—Ä (russian FTS)
- "—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü—ã": 121 —Ç–æ–≤–∞—Ä (russian FTS) ‚úÖ
- "—Ç–µ–ª–µ—Ñ–æ–Ω": 825 —Ç–æ–≤–∞—Ä–æ–≤ (russian FTS)
- "—Ç–µ–ª–µ—Ñ–æ–Ω–∞": 825 —Ç–æ–≤–∞—Ä–æ–≤ (russian FTS) ‚úÖ

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```bash
# –û–±–Ω–æ–≤–∏—Ç—å fts_search.py
# –û–±–Ω–æ–≤–∏—Ç—å main.py (–∏–º–ø–æ—Ä—Ç –∏–∑ fts_module.fts_search)
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç –¥–µ–ø–ª–æ—è
py export_fts_fixed.py

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
psql -h <host> -U <user> -d <database> -f fts_deployment_latest/fts_export_latest.sql
```

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
SELECT to_tsvector('russian', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞');
SELECT to_tsvector('simple', '—Ç–∞–±–ª–µ—Ç–Ω–∏—Ü–∞');
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞

```sql
-- –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞
SELECT pg_size_pretty(pg_relation_size('idx_products_search_vector'));

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
SELECT * FROM pg_stat_user_indexes WHERE indexrelname = 'idx_products_search_vector';
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **GIN –∏–Ω–¥–µ–∫—Å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ts_rank_cd` —Å –≤–µ—Å–æ–≤—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LIMIT –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üö® –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ FTS —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
DROP TRIGGER IF EXISTS update_products_search_vector ON products;
DROP FUNCTION IF EXISTS update_search_vector();
DROP INDEX IF EXISTS idx_products_search_vector;
ALTER TABLE products DROP COLUMN IF EXISTS search_vector;
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ FTS
2. **–õ–æ–≥–∏ PostgreSQL** - –æ—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤/—Ñ—É–Ω–∫—Ü–∏–π
3. **–¢–µ—Å—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏** - `py test_morphology.py`
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–∏—Å–∫–∞** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è (russian –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [x] –í–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [x] –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏
- [x] –ü–∞–∫–µ—Ç—ã –¥–µ–ø–ª–æ—è –≥–æ—Ç–æ–≤—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

---

**–í–µ—Ä—Å–∏—è**: 1.1 (–ò–°–ü–†–ê–í–õ–ï–ù–ê –ú–û–†–§–û–õ–û–ì–ò–Ø)  
**–î–∞—Ç–∞**: 2025-01-27  
**–ê–≤—Ç–æ—Ä**: Personal Super Agent
