# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Stage 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üìã –¶–µ–ª—å —ç—Ç–∞–ø–∞

–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π, –ø–æ–Ω—è—Ç–Ω—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ runtime**

#### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
```
categories.yaml (–∫–æ–Ω—Ñ–∏–≥)
        ‚Üì
  (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ / –¥–µ–ø–ª–æ–µ)
        ‚Üì
PostgreSQL –ë–î (—Ç–∞–±–ª–∏—Ü–∞ categories)
        ‚Üì
  (runtime - –≤—Å–µ —Ä–∞—Å—á—ë—Ç—ã)
        ‚Üì
PriceCalculator
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–î–∏–Ω–∞–º–∏—á–Ω–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ API –±–µ–∑ —Ä–µ–¥–µ–ø–ª–æ—è
- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –≤ runtime
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ **"–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"** —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"

---

### 2. –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ `sync_categories.py`

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

**–†–µ–∂–∏–º 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π**
```bash
python3 sync_categories.py --check
```
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –≤ YAML
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –≤ –ë–î
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–∞—é—â–∏–µ—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–†–µ–∂–∏–º 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
```bash
python3 sync_categories.py
```
- –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ YAML
- –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ù–ï —É–¥–∞–ª—è–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –ë–î

**–†–µ–∂–∏–º 3: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å**
```bash
python3 sync_categories.py --force
```
- –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –í–°–ï –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ YAML
- ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ YAML –∏ –ë–î
2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É `(category, material)`
3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: `rail_base`, `air_base`, `duty`
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö

---

### 3. –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `CATEGORIES_MANAGEMENT.md`

#### –†–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

üìã **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- –†–æ–ª—å –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

üéØ **–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"**
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- Workflow –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

üõ†Ô∏è **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
- –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

üìù **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**
- –ß–µ—Ä–µ–∑ YAML (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- –ß–µ—Ä–µ–∑ API (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

üîß **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `categories`**
- PostgreSQL schema
- –§–æ—Ä–º–∞—Ç JSONB –ø–æ–ª—è

üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

üöÄ **Best Practices**
- DO ‚úÖ / DON'T ‚ùå

üîç **Troubleshooting**
- –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

### 4. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"

#### –í categories.yaml ‚úÖ
```yaml
- category: –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  material: ''
  tnved_code: ''
  duty_rate: 0%
  vat_rate: 20%
  description: –î–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  rates:
    rail_base: 0  # –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    air_base: 0   # –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
```

#### –í PostgreSQL –ë–î (Railway) ‚úÖ
–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production.

#### –í price_calculator.py ‚úÖ
```python
def find_category_by_name(product_name):
    # ...
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
    new_category = next(
        (cat for cat in self.categories if cat.get('category') == '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è'),
        None
    )
    if new_category:
        return new_category
    
    # Fallback
    return {
        "category": "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
        "rates": {"rail_base": 0, "air_base": 0},
        # ...
    }
```

---

### 5. –°–æ–∑–¥–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

#### `check_new_category.py`
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" –≤ –ë–î

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 check_new_category.py
```

**–í—ã–≤–æ–¥:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –ë–î
- –ù–∞–ª–∏—á–∏–µ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –°–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–µ—Ä–≤—ã–µ 10)

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Stage 3

### –§–∞–π–ª—ã

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ:**
- ‚úÖ `sync_categories.py` (270 —Å—Ç—Ä–æ–∫) - —É—Ç–∏–ª–∏—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ `CATEGORIES_MANAGEMENT.md` (440 —Å—Ç—Ä–æ–∫) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `check_new_category.py` (60 —Å—Ç—Ä–æ–∫) - –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- ‚úÖ `REFACTORING_STAGE3.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ:**
- ‚úÖ `config/categories.yaml` - –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
- ‚úÖ `database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `load_categories_from_db`, `upsert_category`
- ‚úÖ `price_calculator.py` - –ª–æ–≥–∏–∫–∞ fallback –∫ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"

### –ú–µ—Ç—Ä–∏–∫–∏

üì¶ **–ü–æ–∫—Ä—ã—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π:** 100%
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚úÖ
- API ‚úÖ
- Best Practices ‚úÖ
- Troubleshooting ‚úÖ

üõ†Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** 3 —É—Ç–∏–ª–∏—Ç—ã
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚úÖ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚úÖ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ

üéØ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- YAML ‚Üí –ë–î —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚úÖ
- "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" –≤–µ–∑–¥–µ ‚úÖ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ ‚úÖ

---

## üß© –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏

### Stage 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏ ‚úÖ
- –¢–∞–±–ª–∏—Ü–∞ `categories` –≥–æ—Ç–æ–≤–∞
- –§—É–Ω–∫—Ü–∏–∏ `load_categories_from_db`, `upsert_category` —Ä–∞–±–æ—Ç–∞—é—Ç
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

### Stage 2: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π ‚úÖ
- `CalculationService` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- `RouteEditorMixin` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ

---

## üéì –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É –ë–î, –∞ –Ω–µ YAML?

**–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**

#### ‚ùå –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ YAML
**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù—É–∂–µ–Ω —Ä–µ–¥–µ–ø–ª–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–µ—Ç API –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å

#### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–î –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (–≤—ã–±—Ä–∞–Ω)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ SQL

#### ‚ùå –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –°–ª–æ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –†–∏—Å–∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö
- –£—Å–ª–æ–∂–Ω—ë–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üìã Workflow: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è

```mermaid
graph TD
    A[–†–µ–¥–∞–∫—Ç–æ—Ä] -->|1| B[–î–æ–±–∞–≤–∏—Ç—å –≤ categories.yaml]
    B -->|2| C[–ö–æ–º–º–∏—Ç –≤ Git]
    C -->|3| D[–î–µ–ø–ª–æ–π –Ω–∞ Railway]
    D -->|4| E[Auto-sync —Å –ë–î]
    E --> F[–ì–æ—Ç–æ–≤–æ]
```

1. –û—Ç–∫—Ä—ã—Ç—å `config/categories.yaml`
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
5. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–±—É–¥—É—â–µ–µ)

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|1| B[POST /api/categories]
    B -->|2| C[Validation]
    C -->|3| D[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î]
    D -->|4| E[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞]
    E --> F[–ì–æ—Ç–æ–≤–æ]
```

*(–¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API endpoint)*

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –≠—Ç–∞–ø 4: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" end-to-end
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ YAML ‚Üí –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Railway

### –£–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

#### API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
```python
# POST /api/categories - –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
# GET /api/categories - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
# PUT /api/categories/{id} - –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
# DELETE /api/categories/{id} - —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
```

#### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```python
from functools import lru_cache

@lru_cache(maxsize=1)
def get_cached_categories():
    return load_categories_from_db()
```

#### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```sql
ALTER TABLE categories ADD COLUMN version INT DEFAULT 1;
ALTER TABLE categories ADD COLUMN updated_at TIMESTAMP DEFAULT NOW();
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –î–æ/–ü–æ—Å–ª–µ

### –î–æ Stage 3:
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (YAML + –ë–î)
- ‚ùå –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚ùå –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚ùå "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" —Ç–æ–ª—å–∫–æ –≤ –ë–î
- ‚ùå –ù–µ—è—Å–Ω—ã–π workflow

### –ü–æ—Å–ª–µ Stage 3:
- ‚úÖ –ß—ë—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ë–î = runtime)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (440 —Å—Ç—Ä–æ–∫)
- ‚úÖ "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" –≤–µ–∑–¥–µ
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–π workflow

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —è—Å–Ω–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω–æ –≥–¥–µ –∏ –∫–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —É—Ç–∏–ª–∏—Ç–∞ `sync_categories.py`
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - 440 —Å—Ç—Ä–æ–∫ best practices
4. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" –≤–µ–∑–¥–µ
5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

---

## üìö –§–∞–π–ª—ã —ç—Ç–∞–ø–∞

1. **sync_categories.py** - —É—Ç–∏–ª–∏—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. **CATEGORIES_MANAGEMENT.md** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **check_new_category.py** - –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
4. **REFACTORING_STAGE3.md** - –æ—Ç—á—ë—Ç –æ–± —ç—Ç–∞–ø–µ

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 10.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** Stage 4 - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è





