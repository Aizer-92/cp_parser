# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ü–æ—à–ª–∏–Ω—ã

## –î–∞—Ç–∞: 06.10.2025

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:
1. **ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π = undefined** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è
2. **–ü–æ—à–ª–∏–Ω—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. **–î—É–±–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π** –≤ —Å–ø–∏—Å–∫–µ
4. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ –Ω–∞ Railway

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. **–û—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î**
**–§–∞–π–ª:** `main.py`

```python
# ‚ö†Ô∏è –ú–ò–ì–†–ê–¶–ò–Ø –û–¢–ö–õ–Æ–ß–ï–ù–ê - –ë–î —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ Railway
# init_database()  # –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ —á—Ç–æ–±—ã –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è –∏–∑–º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–î —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ Railway, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫–∏.

---

### 2. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π (Backend)**
**–§–∞–π–ª:** `backend/api/categories.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ PostgreSQL JSONB (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `dict` –Ω–∞–ø—Ä—è–º—É—é)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è ID –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º

```python
# PostgreSQL JSONB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict –Ω–∞–ø—Ä—è–º—É—é
if isinstance(category_json, dict):
    category_data = category_json.copy()

# –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª—è–µ–º ID –≤ –¥–∞–Ω–Ω—ã–µ
category_data['id'] = category_id

print(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è '{category_data.get('category')}': ID={category_id}, has_id={('id' in category_data)}")
```

---

### 3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –¥—É–±–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
**–§–∞–π–ª:** `backend/api/categories.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# PostgreSQL
cursor.execute("SELECT DISTINCT ON (id) id, data FROM categories ORDER BY id")

# SQLite
cursor.execute("SELECT id, data FROM categories GROUP BY id ORDER BY id")
```

---

### 4. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ ID –Ω–∞ Frontend**
**–§–∞–π–ª:** `static/js/components/CategoriesPanel.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `startEdit`:**
```javascript
// –ì–ª—É–±–æ–∫–∞—è –∫–æ–ø–∏—è —Å —è–≤–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º ID
var categoryClone = JSON.parse(JSON.stringify(category));

// –ö–†–ò–¢–ò–ß–ù–û: –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
if (!categoryClone.id && category.id) {
    categoryClone.id = category.id;
}

console.log('üîß ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', this.editingCategory.id, '—Ç–∏–ø:', typeof this.editingCategory.id);
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `deleteCategory`:**
```javascript
var categoryId = category.id;
console.log('üóëÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å –¥–ª—è ID:', categoryId);
axios.delete('/api/categories/' + categoryId)
```

---

### 5. **–î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—à–ª–∏–Ω**
**–§–∞–π–ª:** `static/js/components/CategoriesPanel.js`

**–§—É–Ω–∫—Ü–∏—è `getCustomsInfo`:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `customs_info` (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
- Fallback –Ω–∞ –ø—Ä—è–º—ã–µ –ø–æ–ª—è (`duty_rate`, `vat_rate`)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤ –∏ —Å—Ç—Ä–æ–∫ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ—à–ª–∏–Ω—ã (–∫–æ–º–±./—Å–ø–µ—Ü.)

```javascript
getCustomsInfo: function(category) {
    var customs = {
        duty_rate: null,
        vat_rate: null,
        duty_type: null,
        certificates: []
    };
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º customs_info
    if (category.customs_info) {
        customs.duty_rate = category.customs_info.duty_rate;
        customs.vat_rate = category.customs_info.vat_rate;
        customs.duty_type = category.customs_info.duty_type;
        customs.certificates = category.customs_info.certificates || [];
    }
    
    // Fallback –Ω–∞ –ø—Ä—è–º—ã–µ –ø–æ–ª—è
    if (!customs.duty_rate && category.duty_rate) {
        customs.duty_rate = category.duty_rate;
    }
    // ...
    
    return customs.duty_rate || customs.vat_rate ? customs : null;
}
```

---

### 6. **–£–ª—É—á—à–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
**–§–∞–π–ª:** `static/js/components/CategoriesPanel.js`

**–ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- **–ü–æ—à–ª–∏–Ω–∞** - —Å –±–µ–π–¥–∂–µ–º —Ç–∏–ø–∞ (–∫–æ–º–±./—Å–ø–µ—Ü.)
- **–ù–î–°** - –ø—Ä–æ—Ü–µ–Ω—Ç –ù–î–°
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```html
<td>
    <span v-if="getCustomsInfo(cat)">
        <strong>{{ getCustomsInfo(cat).duty_rate }}</strong>
        <span v-if="getCustomsInfo(cat).duty_type === 'combined'" class="duty-type-badge">–∫–æ–º–±.</span>
    </span>
</td>
```

---

### 7. **–î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ—à–ª–∏–Ω**
**–§–∞–π–ª:** `static/css/components/categories-panel.css`

```css
/* Customs Info Badges */
.duty-type-badge {
    display: inline-block;
    margin-left: 6px;
    padding: 2px 6px;
    background: #fef3c7;
    color: #92400e;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
}

.certificates-count {
    display: inline-block;
    padding: 4px 10px;
    background: #dbeafe;
    color: #1e40af;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}
```

---

### 8. **–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –∫–µ—à–∞**
**–§–∞–π–ª:** `index.html`

```html
<!-- üî• CACHE BUSTER - –û—á–∏—Å—Ç–∫–∞ Service Worker –∏ –∫–µ—à–∞ -->
<script>
    // –£–¥–∞–ª—è–µ–º Service Worker –µ—Å–ª–∏ –µ—Å—Ç—å
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister();
            }
        });
    }
    
    // –û—á–∏—â–∞–µ–º –∫–µ—à
    if ('caches' in window) {
        caches.keys().then(function(names) {
            for (let name of names) {
                caches.delete(name);
            }
        });
    }
</script>
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**
```
1. –û—Ç–∫—Ä–æ–π Railway logs
2. –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫–∏: "‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 'XXX': ID=123, has_id=True"
3. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
4. –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫–∏: "ID –ø–µ—Ä–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: 123"
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
1. –û—Ç–∫—Ä–æ–π –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
2. –ù–∞–∂–º–∏ "–ò–∑–º–µ–Ω–∏—Ç—å" –Ω–∞ –ª—é–±–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   "üîß ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: 123 —Ç–∏–ø: number"
4. –ò–∑–º–µ–Ω–∏ –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏
5. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è "‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!"
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:**
```
1. –ù–∞–∂–º–∏ "–£–¥–∞–ª–∏—Ç—å" –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   "üóëÔ∏è ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: 123 —Ç–∏–ø: number"
   "üóëÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å –¥–ª—è ID: 123"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —É–¥–∞–ª–µ–Ω–∏–µ
4. –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
```

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—à–ª–∏–Ω:**
```
1. –û—Ç–∫—Ä–æ–π —Ç–∞–±–ª–∏—Ü—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π
2. –ö–æ–ª–æ–Ω–∫–∞ "–ü–æ—à–ª–∏–Ω–∞" –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã
3. –î–ª—è —Ç–µ–∫—Å—Ç–∏–ª—è (—Ñ—É—Ç–±–æ–ª–∫–∏, —Ö—É–¥–∏) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–π–¥–∂ "–∫–æ–º–±."
4. –ö–æ–ª–æ–Ω–∫–∞ "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã" –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å ID  
‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ü–æ—à–ª–∏–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ  
‚úÖ –ù–µ—Ç –¥—É–±–ª–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π  
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ  

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Railway** –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
3. **–£–±–µ–¥–∏—Ç—å—Å—è** —á—Ç–æ –≤—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
4. **–í–Ω–µ–¥—Ä–∏—Ç—å Vue Router** (–∞–∫–∫—É—Ä–∞—Ç–Ω–æ, –±–µ–∑ –ª–æ–º–∞–Ω–∏—è UI)
