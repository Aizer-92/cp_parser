# V3 Frontend - Статус разработки

## Дата: 12.10.2025

## Завершённые этапы ✅

### Этап 1: Базовая инфраструктура ✅
**Создано:**
- `static/js/v3/useFactoriesV3.js` - Композабл для CRUD операций с фабриками
- `static/js/v3/usePositionsV3.js` - Композабл для CRUD операций с позициями
- `static/js/v3/useCalculationsV3.js` - Композабл для CRUD операций с расчётами
- `static/js/v3/useSFTPUpload.js` - Композабл для загрузки фото на Beget Cloud SFTP
- `services/sftp_uploader.py` - Backend сервис для загрузки на SFTP
- API endpoints в `main.py`:
  - `POST /api/v3/upload/photo` - Загрузка одного фото
  - `POST /api/v3/upload/photos` - Загрузка нескольких фото

**SFTP Configuration:**
- Host: sftp.ru1.storage.beget.cloud
- Путь: /calc/
- Фото загружаются с уникальными именами: `pos_{position_id}_{timestamp}.ext`

---

### Этап 2: Quick Mode (Быстрый расчёт) ✅
**Создано:**
- `static/js/v3/QuickModeV3.js` - Компонент быстрого расчёта
- `static/js/v3/PriceCalculatorAppV3.js` - Главный компонент с навигацией
- `static/css/v3-styles.css` - Минималистичные стили без эмодзи
- `index_v3.html` - HTML страница V3 интерфейса
- Route в `main.py`: `GET /v3` - доступ к V3 интерфейсу

**Функциональность Quick Mode:**
- Форма ввода: товар, категория (автоопределение), цена, количество, вес, наценка
- Поле WeChat/URL с кнопкой "Из списка" для выбора фабрики
- Расчёт через существующий V3 API (`/api/v3/calculate/execute`)
- Отображение ВСЕХ маршрутов (ЖД, Авиа, Контракт, Prologix, Море)
- Динамическое определение лучшего маршрута
- Кнопка "Сохранить в Позиции" (заглушка)

---

### Этап 3: Positions (Позиции) ✅
**Создано:**
- `static/js/v3/PositionsListV3.js` - Список всех позиций
- `static/js/v3/PositionFormV3.js` - Форма создания/редактирования позиции

**Функциональность PositionsList:**
- Сетка карточек с фото
- Поиск по названию и описанию
- Фильтр по категории
- Отображение количества фото и расчётов
- Кнопки: Открыть, Редактировать, Удалить

**Функциональность PositionForm:**
- Поля:
  - **Название** - основное название позиции
  - **Категория** - с автокомплитом
  - **Описание** - описание товара (материал, размеры, вес)
  - **Кастомизация** - что делаем с товаром (печать, гравировка)
  - **Материал**, **Цвета** - дополнительные поля
- **Загрузка фотографий:**
  - Drag & Drop область
  - Выбор файлов через диалог
  - Превью фотографий
  - Установка основной фотографии (метка "Основная")
  - Удаление фото
  - Загрузка на SFTP сервер Beget Cloud
  - Progress bar

---

## Что работает прямо сейчас

### Доступ к V3
1. Запустить: `py main.py`
2. Перейти: http://localhost:8000/v3 (требуется авторизация)

### Quick Mode
- Можно делать быстрые расчёты
- Все маршруты отображаются динамически
- Результаты показываются в карточках

### Positions
- Можно создавать позиции с фото
- Фото загружаются на SFTP
- Список позиций отображается сеткой
- Поиск и фильтры работают

---

## В разработке (TODO)

### Этап 4: Calculations (Расчёты) ⏳
**Что нужно сделать:**
- `CalculationFormV3.js` - Форма создания расчёта для позиции
- `CalculationResultsV3.js` - Результаты с ВСЕМИ маршрутами
- `PositionDetailsV3.js` - Детали позиции + список расчётов
- Интеграция: клик на позицию → открывается детали + расчёты

**Функции:**
- Выбор фабрики (из списка или ввод вручную)
- Параметры: цена, количество, наценка, вес/упаковка
- Расчёт через V3 API
- Сохранение в БД с привязкой к position_id
- Пересчёт (кнопка ♻️)

---

### Этап 5: Compare (Сравнение) ⏳
**Что нужно сделать:**
- `CompareCalculationsV3.js` - Таблица сравнения расчётов
- Логика выбора лучших показателей
- Рекомендации

**Функции:**
- Выбор нескольких расчётов (чекбоксы)
- Кнопка "Сравнить выбранные"
- Таблица с колонками для каждого расчёта
- Маркеры "★ ЛУЧШЕ" для лучших показателей
- Текстовые рекомендации

---

### Этап 6: Factories (Фабрики) ⏳
**Что нужно сделать:**
- `FactorySelectorV3.js` - Модалка выбора фабрики
- `FactoriesManagerV3.js` - Управление справочником фабрик

**Функции:**
- CRUD операций с фабриками
- Поля: название, контакт, сроки, цена образца, комментарий
- Интеграция с формами расчётов (кнопка "Из списка")

---

### Этап 7: Integration (Интеграция) ⏳
**Что нужно сделать:**
- Интеграция истории (таб "История")
- Навигация между компонентами
- Финальная полировка UI
- Тестирование всех флоу

---

## Технический стек

### Frontend
- **Vue 3** (без build step)
- **Axios** для API запросов
- Чистый CSS (без фреймворков)
- Композаблы для переиспользуемой логики

### Backend
- **FastAPI** - веб-фреймворк
- **SQLAlchemy 2.0** - ORM
- **PostgreSQL** - база данных (Railway)
- **Paramiko** - SFTP клиент для загрузки фото
- **Beget Cloud SFTP** - хранилище фото

### API
- V3 API эндпоинты (уже готовы):
  - `/api/v3/factories/` - CRUD фабрик
  - `/api/v3/positions/` - CRUD позиций
  - `/api/v3/calculations/` - CRUD расчётов
  - `/api/v3/calculations/{id}/recalculate` - пересчёт
  - `/api/v3/upload/photo` - загрузка фото
  - `/api/v3/calculate/execute` - расчёт (V2 API, переиспользуется)

---

## Дизайн-принципы

1. **Без эмодзи в UI** - только текст и иконки
2. **Минималистичный дизайн** - светлый фон, акценты
3. **Простая навигация** - табы вверху
4. **Быстрые действия** - Quick Mode для одноразовых расчётов
5. **Детальные проекты** - Positions для сложных сценариев
6. **SFTP для фото** - облачное хранилище вместо локального

---

## Следующие шаги

1. **Этап 4: Calculations** - форма расчётов и детали позиции
2. **Этап 5: Compare** - сравнение вариантов
3. **Этап 6: Factories** - справочник фабрик
4. **Этап 7: Integration** - финальная интеграция

**Приоритет: Этап 4** - это ключевой функционал для работы с позициями.

---

## Как запустить

```bash
cd projects/price_calculator
py main.py
```

Перейти: http://localhost:8000/v3

**Требуется авторизация!** Используйте существующие учётные данные V2.

